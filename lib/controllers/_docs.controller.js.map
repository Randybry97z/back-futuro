{"version":3,"file":"_docs.controller.js","names":["_models","_interopRequireDefault","require","path","pdf","zip","getPDFTargetById","req","res","params","item","pdfFileCard1","resolve","pdfFileCard2","pdfFileCard3","pdfFileCard4","name","pdfFile","concat","download","error","status","json","mensaje","success","exports","getPDFParticipante","participante","db","Participante","findByPk","participanteId","attributes","exclude","include","model","User","Entity","InstitutionalizationHistory","content","participante_name","participante_lastname","participante_second_surname","participante_birthday","participante_mail","participante_phone","participante_code","participante_gender","participante_nationality","participante_language","participante_scholarship","Entities","entity_name","entity_city","entity_address","entity_representative_name","entity_representative_mail","entity_representative_phone","InstitutionalizationHistories","history_acommodation_time","history_previous_acommodation","history_previous_ethos","history_quantity_programs","history_nohome_state","history_assault_state","history_social_profile","history_problematic","history_entity","history_register_date","history_updown_date","history_updown_reason","create","toFile","participante_id","err","result"],"sources":["../../src/controllers/_docs.controller.js"],"sourcesContent":["var path = require('path');\r\nconst pdf = require('html-pdf');\r\nimport db from \"../database/models\";\r\nvar zip = require('express-zip');\r\n\r\n\r\nexport const getPDFTargetById = async (req, res) => {\r\n  try{\r\n    //res.status(200).json({ mensaje: 'Estás por generar un pdf', success: true }) }\r\n    if(req.params.item == 5){\r\n      \r\n      let pdfFileCard1 = path.resolve(`./src/assets/docs/items-1.pdf`);\r\n      let pdfFileCard2 = path.resolve(`./src/assets/docs/items-2.pdf`);\r\n      let pdfFileCard3 = path.resolve(`./src/assets/docs/items-3.pdf`);\r\n      let pdfFileCard4 = path.resolve(`./src/assets/docs/items-4.pdf`);\r\n      res.zip([\r\n        { path: pdfFileCard1, name: 'tarjeta-1.pdf' },\r\n        { path: pdfFileCard2, name: 'tarjeta-2.pdf' },\r\n        { path: pdfFileCard3, name: 'tarjeta-3.pdf' },\r\n        { path: pdfFileCard4, name: 'tarjeta-4.pdf' },\r\n\r\n     ], 'Tarjetas.zip');\r\n    }else{\r\n      let path = require(\"path\");\r\n      let pdfFile = path.resolve(`./src/assets/docs/items-${req.params.item}.pdf`)\r\n      res.download(pdfFile);   \r\n    }\r\n  } catch (error) {\r\n    res.status(400).json({ mensaje: 'Ocurrio un error al generar el pfp', success: false });\r\n  }\r\n}\r\n\r\nexport const getPDFParticipante = async (req, res) => {\r\n  try{\r\n    const participante = await db.Participante.findByPk(req.params.participanteId, {\r\n      attributes: { exclude: [\"participante_age\"] },\r\n      include: [{ model: db.User, attributes: [\"user_name\"] }, {model: db.Entity}, {model: db.InstitutionalizationHistory}],\r\n    });\r\n      if (participante) {\r\n        const content = `\r\n        <!doctype html>\r\n          <html>\r\n              <head>\r\n                  <meta charset=\"utf-8\">\r\n                  <title>${participante.participante_name} | Informe</title>\r\n                  <style>\r\n                      h1 {\r\n                          color: black;\r\n                      }\r\n                  </style>\r\n              </head>\r\n              <body>\r\n                  <div style=\"width: '100%',display: 'flex', justify-content:'center'\"><h2>${participante.participante_name} ${participante.participante_lastname} - Reporte</h2></div>\r\n                  <div id=\"section\" style=\"border: 1px solid #ddd; padding: 5px; margin-bottom: 1rem\">\r\n                      <h3>Datos de la Entidad</h3>\r\n                      <div>\r\n                        <div class=\"participante_value\"> <b>Nombre: </b> ${participante.participante_name}</div>\r\n                        <div class=\"participante_value\"> <b>Apellido Paterno: </b> ${participante.participante_lastname}</div>\r\n                        <div class=\"participante_value\"> <b>Apellido Materno: </b> ${participante.participante_second_surname}</div>\r\n                        <div class=\"participante_value\"> <b>Fecha de Nacimiento: </b> ${participante.participante_birthday}</div>\r\n                        <div class=\"participante_value\"> <b>Correo: </b> ${participante.participante_mail}</div>\r\n                        <div class=\"participante_value\"> <b>Teléfono: </b> ${participante.participante_phone}</div>\r\n                        <div class=\"participante_value\"> <b>Código Postal: </b> ${participante.participante_code}</div>\r\n                        <div class=\"participante_value\"> <b>Género: </b> ${participante.participante_gender}</div>\r\n                        <div class=\"participante_value\"> <b>Nacionalidad: </b> ${participante.participante_nationality}</div>\r\n                        <div class=\"participante_value\"> <b>Lenguaje: </b> ${participante.participante_language}</div>\r\n                        <div class=\"participante_value\"> <b>Escolaridad: </b> ${participante.participante_scholarship}</div>\r\n                      </div>\r\n                  </div>\r\n                  <div id=\"section\" style=\"border: 1px solid #ddd; padding: 5px; margin-bottom: 1rem\">\r\n                    <h3>Datos de la Entidad</h3>\r\n                    <div>\r\n                      <div class=\"participante_value\"> <b>Nombre de la Entidad: </b> ${participante.Entities[0].entity_name}</div>\r\n                      <div class=\"participante_value\"> <b>Ciudad: </b> ${participante.Entities[0].entity_city}</div>\r\n                      <div class=\"participante_value\"> <b>Dirección: </b> ${participante.Entities[0].entity_address}</div>\r\n                      <div class=\"participante_value\"> <b>Nombre del representante Legal: </b> ${participante.Entities[0].entity_representative_name}</div>\r\n                      <div class=\"participante_value\"> <b>Correo del representante Legal: </b> ${participante.Entities[0].entity_representative_mail}</div>\r\n                      <div class=\"participante_value\"> <b>Teléfono del representante Legal: </b> ${participante.Entities[0].entity_representative_phone}</div>\r\n                    </div>\r\n                  </div>\r\n                  <div id=\"section\" style=\"border: 1px solid #ddd; padding: 5px; margin-bottom: 1rem\">\r\n                    <h3>Historial de Institucionalización</h3>\r\n                    <div>\r\n                      <div class=\"participante_value\"> <b>¿Cuánto tiempo lleva viviendo sin un alojamiento que puedas considerar propio y estable?: </b> ${participante.InstitutionalizationHistories[0].history_acommodation_time}</div>\r\n                      <div class=\"participante_value\"> <b>¿Dónde vivías antes de entrar en este programa?: </b> ${participante.InstitutionalizationHistories[0].history_previous_acommodation}</div>\r\n                      <div class=\"participante_value\"> <b>Perfil Ethos: </b> ${participante.InstitutionalizationHistories[0].history_previous_ethos}</div>\r\n                      <div class=\"participante_value\"> <b>Aproximadamente, ¿En cuántas instituciones o recursos de proteccion social has estado antes de llegar a Fururo&Co: </b> ${participante.InstitutionalizationHistories[0].history_quantity_programs}</div>\r\n                      <div class=\"participante_value\"> <b>¿Has estado en situación de calle?: </b> ${participante.InstitutionalizationHistories[0].history_nohome_state}</div>\r\n                      <div class=\"participante_value\"> <b>¿Has sufrido alguna situación previa de agresión en el entorno de vivienda o alojamiento en el que has estado?: </b> ${participante.InstitutionalizationHistories[0].history_assault_state}</div>\r\n                      <div class=\"participante_value\"> <b>Perfil Social: </b> ${participante.InstitutionalizationHistories[0].history_social_profile}</div>\r\n                      <div class=\"participante_value\"> <b>Problemáticas: </b> ${participante.InstitutionalizationHistories[0].history_problematic}</div>\r\n                      <div class=\"participante_value\"> <b>Entidad de procedencia: </b> ${participante.InstitutionalizationHistories[0].history_entity}</div>\r\n                      <div class=\"participante_value\"> <b>Fecha de Alta: </b> ${participante.InstitutionalizationHistories[0].history_register_date}</div>\r\n                      <div class=\"participante_value\"> <b>Fecha de Baja: </b> ${participante.InstitutionalizationHistories[0].history_updown_date}</div>\r\n                      <div class=\"participante_value\"> <b>Motivo de baja: </b> ${participante.InstitutionalizationHistories[0].history_updown_reason}</div>\r\n                    </div>\r\n                  </div>\r\n              </body>\r\n          </html>\r\n        `;\r\n\r\n        //res.status(200).json({ mensaje: 'Se ha generado el reporte', participante:participante, success: true });   \r\n        pdf.create(content).toFile(`./src/assets/docs/informe-${participante.participante_id}.pdf`, function(err, result) {\r\n        if (err){\r\n          res.status(400).json({ mensaje: 'Ocurrio un error al generar el reporte', success: false });\r\n        } else {\r\n          let path = require(\"path\");\r\n          let pdfFile = path.resolve(`./src/assets/docs/informe-${participante.participante_id}.pdf`)\r\n          res.download(pdfFile);  \r\n        }\r\n        });\r\n      } else {\r\n        res\r\n          .status(400)\r\n          .json({ mensaje: \"participante no encontrado\", success: false });\r\n        }\r\n  } catch (error) {\r\n    res.status(400).json({ mensaje: 'Ocurrio un error al generar el pfp', success: false });\r\n  }\r\n}"],"mappings":"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"}